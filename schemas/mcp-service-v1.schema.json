{
  "$id": "https://clarity.dev/schemas/mcp-service-v1.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "required": ["apiVersion", "kind", "metadata", "spec"],
  "properties": {
    "apiVersion": { "const": "clarity.runtime/v1" },
    "kind": { "const": "MCPService" },
    "metadata": {
      "type": "object",
      "required": ["sourceFile", "module", "serviceType"],
      "properties": {
        "serviceId": { "type": "string", "pattern": "^svc_[a-f0-9]{12}$" },
        "displayName": { "type": "string", "minLength": 1, "maxLength": 80 },
        "sourceFile": { "type": "string" },
        "workspaceRoot": { "type": "string" },
        "module": { "type": "string" },
        "version": { "type": "string" },
        "artifactSha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },
        "serviceType": { "enum": ["mcp", "agent"] },
        "agent": {
          "type": "object",
          "required": ["agentId", "name", "role", "objective", "triggers"],
          "properties": {
            "agentId": { "type": "string", "minLength": 1 },
            "name": { "type": "string", "minLength": 1 },
            "role": { "type": "string", "minLength": 1 },
            "objective": { "type": "string", "minLength": 1 },
            "triggers": {
              "type": "array",
              "minItems": 1,
              "items": { "enum": ["timer", "event", "call", "api", "a2a"] }
            },
            "inputs": { "type": "array", "items": { "type": "string" } },
            "outputs": { "type": "array", "items": { "type": "string" } },
            "allowedMcpTools": { "type": "array", "items": { "type": "string" } },
            "allowedLlmProviders": { "type": "array", "items": { "type": "string" } },
            "handoffTargets": { "type": "array", "items": { "type": "string" } },
            "dependsOn": { "type": "array", "items": { "type": "string" } },
            "version": { "type": "string" }
          },
          "additionalProperties": false
        },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "additionalProperties": false,
      "allOf": [
        {
          "if": {
            "properties": {
              "serviceType": { "const": "agent" }
            },
            "required": ["serviceType"]
          },
          "then": {
            "required": ["agent"]
          }
        }
      ]
    },
    "spec": {
      "type": "object",
      "required": ["origin", "enabled", "autostart", "restartPolicy", "policyRef"],
      "properties": {
        "origin": {
          "oneOf": [
            {
              "type": "object",
              "required": ["type", "wasmPath", "entry"],
              "properties": {
                "type": { "const": "local_wasm" },
                "wasmPath": { "type": "string" },
                "entry": { "type": "string" },
                "args": { "type": "array", "items": { "type": "string" } },
                "env": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["name"],
                    "properties": {
                      "name": { "type": "string" },
                      "value": { "type": "string" },
                      "secretRef": { "type": "string" }
                    },
                    "additionalProperties": false
                  }
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "required": ["type", "endpoint", "transport"],
              "properties": {
                "type": { "const": "remote_mcp" },
                "endpoint": { "type": "string", "format": "uri" },
                "transport": { "enum": ["streamable_http", "sse_http"] },
                "authRef": { "type": "string" },
                "timeoutMs": { "type": "integer", "minimum": 100, "maximum": 120000 },
                "allowedTools": { "type": "array", "items": { "type": "string" } },
                "maxPayloadBytes": { "type": "integer", "minimum": 1024, "maximum": 10485760 },
                "maxConcurrency": { "type": "integer", "minimum": 1, "maximum": 256 }
              },
              "additionalProperties": false
            }
          ]
        },
        "enabled": { "type": "boolean" },
        "autostart": { "type": "boolean" },
        "restartPolicy": {
          "type": "object",
          "required": ["mode", "maxRestarts", "windowSeconds"],
          "properties": {
            "mode": { "enum": ["never", "on-failure", "always"] },
            "maxRestarts": { "type": "integer", "minimum": 0, "maximum": 100 },
            "windowSeconds": { "type": "integer", "minimum": 1, "maximum": 3600 }
          },
          "additionalProperties": false
        },
        "policyRef": { "type": "string" },
        "toolNamespace": { "type": "string" }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
